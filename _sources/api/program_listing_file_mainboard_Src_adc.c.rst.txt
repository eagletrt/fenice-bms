
.. _program_listing_file_mainboard_Src_adc.c:

Program Listing for File adc.c
==============================

|exhale_lsh| :ref:`Return to documentation for file <file_mainboard_Src_adc.c>` (``mainboard/Src/adc.c``)

.. |exhale_lsh| unicode:: U+021B0 .. UPWARDS ARROW WITH TIP LEFTWARDS

.. code-block:: cpp

   
   /* Includes ------------------------------------------------------------------*/
   #include "adc.h"
   
   /* USER CODE BEGIN 0 */
   
   /* USER CODE END 0 */
   
   ADC_HandleTypeDef hadc1;
   ADC_HandleTypeDef hadc2;
   DMA_HandleTypeDef hdma_adc1;
   DMA_HandleTypeDef hdma_adc2;
   
   /* ADC1 init function */
   void MX_ADC1_Init(void)
   {
   
     /* USER CODE BEGIN ADC1_Init 0 */
   
     /* USER CODE END ADC1_Init 0 */
   
     ADC_ChannelConfTypeDef sConfig = {0};
   
     /* USER CODE BEGIN ADC1_Init 1 */
   
     /* USER CODE END ADC1_Init 1 */
     hadc1.Instance = ADC1;
     hadc1.Init.ClockPrescaler = ADC_CLOCK_SYNC_PCLK_DIV8;
     hadc1.Init.Resolution = ADC_RESOLUTION_12B;
     hadc1.Init.ScanConvMode = DISABLE;
     hadc1.Init.ContinuousConvMode = ENABLE;
     hadc1.Init.DiscontinuousConvMode = DISABLE;
     hadc1.Init.ExternalTrigConvEdge = ADC_EXTERNALTRIGCONVEDGE_NONE;
     hadc1.Init.ExternalTrigConv = ADC_SOFTWARE_START;
     hadc1.Init.DataAlign = ADC_DATAALIGN_RIGHT;
     hadc1.Init.NbrOfConversion = 1;
     hadc1.Init.DMAContinuousRequests = ENABLE;
     hadc1.Init.EOCSelection = ADC_EOC_SINGLE_CONV;
     if (HAL_ADC_Init(&hadc1) != HAL_OK)
     {
       Error_Handler();
     }
     sConfig.Channel = ADC_CHANNEL_12;
     sConfig.Rank = 1;
     sConfig.SamplingTime = ADC_SAMPLETIME_480CYCLES;
     if (HAL_ADC_ConfigChannel(&hadc1, &sConfig) != HAL_OK)
     {
       Error_Handler();
     }
     /* USER CODE BEGIN ADC1_Init 2 */
   
     /* USER CODE END ADC1_Init 2 */
   
   }
   /* ADC2 init function */
   void MX_ADC2_Init(void)
   {
   
     /* USER CODE BEGIN ADC2_Init 0 */
   
     /* USER CODE END ADC2_Init 0 */
   
     ADC_ChannelConfTypeDef sConfig = {0};
   
     /* USER CODE BEGIN ADC2_Init 1 */
   
     /* USER CODE END ADC2_Init 1 */
     hadc2.Instance = ADC2;
     hadc2.Init.ClockPrescaler = ADC_CLOCK_SYNC_PCLK_DIV8;
     hadc2.Init.Resolution = ADC_RESOLUTION_12B;
     hadc2.Init.ScanConvMode = DISABLE;
     hadc2.Init.ContinuousConvMode = ENABLE;
     hadc2.Init.DiscontinuousConvMode = DISABLE;
     hadc2.Init.ExternalTrigConvEdge = ADC_EXTERNALTRIGCONVEDGE_NONE;
     hadc2.Init.ExternalTrigConv = ADC_SOFTWARE_START;
     hadc2.Init.DataAlign = ADC_DATAALIGN_RIGHT;
     hadc2.Init.NbrOfConversion = 1;
     hadc2.Init.DMAContinuousRequests = ENABLE;
     hadc2.Init.EOCSelection = ADC_EOC_SINGLE_CONV;
     if (HAL_ADC_Init(&hadc2) != HAL_OK)
     {
       Error_Handler();
     }
     sConfig.Channel = ADC_CHANNEL_13;
     sConfig.Rank = 1;
     sConfig.SamplingTime = ADC_SAMPLETIME_480CYCLES;
     if (HAL_ADC_ConfigChannel(&hadc2, &sConfig) != HAL_OK)
     {
       Error_Handler();
     }
     /* USER CODE BEGIN ADC2_Init 2 */
   
     /* USER CODE END ADC2_Init 2 */
   
   }
   
   void HAL_ADC_MspInit(ADC_HandleTypeDef* adcHandle)
   {
   
     GPIO_InitTypeDef GPIO_InitStruct = {0};
     if(adcHandle->Instance==ADC1)
     {
     /* USER CODE BEGIN ADC1_MspInit 0 */
   
     /* USER CODE END ADC1_MspInit 0 */
       /* ADC1 clock enable */
       __HAL_RCC_ADC1_CLK_ENABLE();
   
       __HAL_RCC_GPIOC_CLK_ENABLE();
       GPIO_InitStruct.Pin = IP_LOW_Pin;
       GPIO_InitStruct.Mode = GPIO_MODE_ANALOG;
       GPIO_InitStruct.Pull = GPIO_NOPULL;
       HAL_GPIO_Init(IP_LOW_GPIO_Port, &GPIO_InitStruct);
   
       /* ADC1 DMA Init */
       /* ADC1 Init */
       hdma_adc1.Instance = DMA2_Stream0;
       hdma_adc1.Init.Channel = DMA_CHANNEL_0;
       hdma_adc1.Init.Direction = DMA_PERIPH_TO_MEMORY;
       hdma_adc1.Init.PeriphInc = DMA_PINC_DISABLE;
       hdma_adc1.Init.MemInc = DMA_MINC_ENABLE;
       hdma_adc1.Init.PeriphDataAlignment = DMA_PDATAALIGN_HALFWORD;
       hdma_adc1.Init.MemDataAlignment = DMA_MDATAALIGN_HALFWORD;
       hdma_adc1.Init.Mode = DMA_CIRCULAR;
       hdma_adc1.Init.Priority = DMA_PRIORITY_HIGH;
       hdma_adc1.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
       if (HAL_DMA_Init(&hdma_adc1) != HAL_OK)
       {
         Error_Handler();
       }
   
       __HAL_LINKDMA(adcHandle,DMA_Handle,hdma_adc1);
   
       /* ADC1 interrupt Init */
       HAL_NVIC_SetPriority(ADC_IRQn, 0, 0);
       HAL_NVIC_EnableIRQ(ADC_IRQn);
     /* USER CODE BEGIN ADC1_MspInit 1 */
   
     /* USER CODE END ADC1_MspInit 1 */
     }
     else if(adcHandle->Instance==ADC2)
     {
     /* USER CODE BEGIN ADC2_MspInit 0 */
   
     /* USER CODE END ADC2_MspInit 0 */
       /* ADC2 clock enable */
       __HAL_RCC_ADC2_CLK_ENABLE();
   
       __HAL_RCC_GPIOC_CLK_ENABLE();
       GPIO_InitStruct.Pin = IP_HIGH_Pin;
       GPIO_InitStruct.Mode = GPIO_MODE_ANALOG;
       GPIO_InitStruct.Pull = GPIO_NOPULL;
       HAL_GPIO_Init(IP_HIGH_GPIO_Port, &GPIO_InitStruct);
   
       /* ADC2 DMA Init */
       /* ADC2 Init */
       hdma_adc2.Instance = DMA2_Stream2;
       hdma_adc2.Init.Channel = DMA_CHANNEL_1;
       hdma_adc2.Init.Direction = DMA_PERIPH_TO_MEMORY;
       hdma_adc2.Init.PeriphInc = DMA_PINC_DISABLE;
       hdma_adc2.Init.MemInc = DMA_MINC_ENABLE;
       hdma_adc2.Init.PeriphDataAlignment = DMA_PDATAALIGN_HALFWORD;
       hdma_adc2.Init.MemDataAlignment = DMA_MDATAALIGN_HALFWORD;
       hdma_adc2.Init.Mode = DMA_CIRCULAR;
       hdma_adc2.Init.Priority = DMA_PRIORITY_HIGH;
       hdma_adc2.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
       if (HAL_DMA_Init(&hdma_adc2) != HAL_OK)
       {
         Error_Handler();
       }
   
       __HAL_LINKDMA(adcHandle,DMA_Handle,hdma_adc2);
   
       /* ADC2 interrupt Init */
       HAL_NVIC_SetPriority(ADC_IRQn, 0, 0);
       HAL_NVIC_EnableIRQ(ADC_IRQn);
     /* USER CODE BEGIN ADC2_MspInit 1 */
   
     /* USER CODE END ADC2_MspInit 1 */
     }
   }
   
   void HAL_ADC_MspDeInit(ADC_HandleTypeDef* adcHandle)
   {
   
     if(adcHandle->Instance==ADC1)
     {
     /* USER CODE BEGIN ADC1_MspDeInit 0 */
   
     /* USER CODE END ADC1_MspDeInit 0 */
       /* Peripheral clock disable */
       __HAL_RCC_ADC1_CLK_DISABLE();
   
       HAL_GPIO_DeInit(IP_LOW_GPIO_Port, IP_LOW_Pin);
   
       /* ADC1 DMA DeInit */
       HAL_DMA_DeInit(adcHandle->DMA_Handle);
   
       /* ADC1 interrupt Deinit */
     /* USER CODE BEGIN ADC1:ADC_IRQn disable */
           /* HAL_NVIC_DisableIRQ(ADC_IRQn); */
     /* USER CODE END ADC1:ADC_IRQn disable */
   
     /* USER CODE BEGIN ADC1_MspDeInit 1 */
   
     /* USER CODE END ADC1_MspDeInit 1 */
     }
     else if(adcHandle->Instance==ADC2)
     {
     /* USER CODE BEGIN ADC2_MspDeInit 0 */
   
     /* USER CODE END ADC2_MspDeInit 0 */
       /* Peripheral clock disable */
       __HAL_RCC_ADC2_CLK_DISABLE();
   
       HAL_GPIO_DeInit(IP_HIGH_GPIO_Port, IP_HIGH_Pin);
   
       /* ADC2 DMA DeInit */
       HAL_DMA_DeInit(adcHandle->DMA_Handle);
   
       /* ADC2 interrupt Deinit */
     /* USER CODE BEGIN ADC2:ADC_IRQn disable */
           /* HAL_NVIC_DisableIRQ(ADC_IRQn); */
     /* USER CODE END ADC2:ADC_IRQn disable */
   
     /* USER CODE BEGIN ADC2_MspDeInit 1 */
   
     /* USER CODE END ADC2_MspDeInit 1 */
     }
   }
   
   /* USER CODE BEGIN 1 */
   
   /* USER CODE END 1 */
   
   /************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/
